# 调试指南

## 问题：机器人移动速度很慢

### 症状
- 输入速度命令 1.0 m/s
- 实际移动速度只有 0.01-0.07 m/s
- 机器人高度下降（0.40m → 0.33m）
- 投影重力偏离（机器人倾斜）

### 可能原因

#### 1. 速度命令范围不匹配
训练时使用的速度范围可能较小，导致大速度命令时策略响应不足。

**解决方法**：使用较小的速度值
```bash
# 建议速度范围：0.3-0.8 m/s
> 0.5 0 0    # 前进 0.5 m/s
> 0.3 0 0    # 前进 0.3 m/s（更稳定）
```

#### 2. 策略训练不充分
当前策略训练了 499 次迭代，可能还需要更多训练。

**检查训练配置**：
```python
# 查看 walk_test_env_cfg.py 中的速度范围
base_velocity = mdp.UniformVelocityCommandCfg(
    ranges: UniformVelocityCommandCfg.RangesCfg(
        lin_vel_x=(0.0, 1.0),     # 前进速度范围
        lin_vel_y=(-0.5, 0.5),    # 横移速度范围
        ang_vel_z=(-0.5, 0.5),    # 旋转速度范围
    )
)
```

#### 3. 观测构建问题
检查速度命令在观测中的位置和缩放。

**当前实现** (mujoco_deploy.py:230-231)：
```python
# 速度命令（应用缩放）
velocity_command = np.array([self.vx, self.vy, self.wz]) * self.vel_command_scale
```

### 调试步骤

#### 步骤1：测试站立稳定性
```bash
> s          # 停止，保持站立
```
观察机器人是否能稳定站立（高度保持 ~0.40m）

#### 步骤2：测试小速度
```bash
> 0.3 0 0    # 前进 0.3 m/s
```
观察：
- 机器人是否前进
- 高度是否保持
- 投影重力是否接近 [0, 0, -1]

#### 步骤3：测试中等速度
```bash
> 0.5 0 0    # 前进 0.5 m/s
```
比较移动速度是否增加

#### 步骤4：检查调试输出
前100步会输出调试信息：
```
[调试] 步骤20:
  IsaacLab动作(FL): [0.176 -0.385 0.265]
  IsaacLab动作(FR): [-0.046 -0.346 0.470]
  基座高度: 0.396
  投影重力: [0.008 -0.003 -1.000]
```

检查：
- **IsaacLab动作**：应该在 [-0.5, 0.5] 范围内（乘以 action_scale 0.25 后）
- **基座高度**：应该保持在 0.38-0.40m
- **投影重力**：应该接近 [0, 0, -1]（直立）

### 已知问题

1. **大速度命令（1.0 m/s）响应很小**
   - 原因：可能是训练时速度范围较小
   - 临时解决：使用 0.3-0.5 m/s 的速度

2. **机器人高度下降**
   - 原因：策略可能没有完全收敛
   - 症状：高度从 0.40m 降到 0.33m

3. **机器人倾斜**
   - 原因：投影重力偏离 [0, 0, -1]
   - 影响：运动不稳定

### 建议

1. **使用较小速度**：0.3-0.5 m/s
2. **增加训练迭代**：当前 499 次可能不够
3. **检查训练配置**：确认速度范围和奖励设置
4. **重新训练策略**：在 MuJoCo 中直接训练（Sim2Real）

### 参考配置

IsaacLab 默认速度范围（从代码推测）：
```python
lin_vel_x: (0.0, 1.0)     # 前进
lin_vel_y: (-0.5, 0.5)    # 横移
ang_vel_z: (-0.5, 0.5)    # 旋转
```

建议测试速度：
```python
保守：  (0.3, 0.0, 0.0)   # 稳定但慢
中等：  (0.5, 0.0, 0.0)   # 平衡
激进：  (0.8, 0.0, 0.0)   # 快但不稳定
```
